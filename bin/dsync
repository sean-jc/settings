#!/bin/bash
if [[ $# -ne 1 ]]; then
        printf "usage: dsync <host>\n"
        exit 1
fi

ssh $1 "mkdir -p /data/local/seanjc/build/kernel/vm/arch/x86/boot; mkdir -p /data/local/seanjc/build/kernel/vm/lib/modules; mkdir -p /data/local/seanjc/build/qemu/static-5.2; mkdir -p /data/local/seanjc/go/src/github.com/sean-jc; mkdir -p /data/local/seanjc/go/src/kernel.org"
rsync --checksum ~/.bashrc $1:/data/local/seanjc
rsync --checksum ~/.inputrc $1:/data/local/seanjc
rsync --checksum ~/.vimrc $1:/data/local/seanjc
rsync --checksum ~/build/qemu/static-5.2/qemu-system-x86_64 $1:/data/local/seanjc/build/qemu/static-5.2
rsync --checksum --recursive --links ~/build/pc-bios $1:/data/local/seanjc/build/qemu/static-5.2
rsync --checksum --recursive --links ~/build/ovmf $1:/data/local/seanjc/build
rsync --checksum --recursive --exclude='.git*' ~/go/src/github.com/sean-jc/settings $1:/data/local/seanjc/go/src/github.com/sean-jc
ssh $1 "chmod +x /data/local/seanjc/go/src/github.com/sean-jc/settings/bin/timeout"
rsync --checksum --recursive --links --exclude='.git*' --exclude='logs*' ~/go/src/kernel.org/kvm-unit-tests $1:/data/local/seanjc/go/src/kernel.org
ssh $1 "rm -f /data/local/seanjc/build/qemu/stable; ln -s /data/local/seanjc/build/qemu/static-5.2/qemu-system-x86_64 /data/local/seanjc/build/qemu/stable"
rsync --checksum ~/build/kernel/vm/arch/x86/boot/bzImage $1:/data/local/seanjc/build/kernel/vm/arch/x86/boot
rsync --checksum --recursive ~/build/kernel/vm/lib/modules $1:/data/local/seanjc/build/kernel/vm/lib
