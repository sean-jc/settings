#!/bin/bash
. $SETTINGS/bin/stubdirs-common
. $SETTINGS/bin/stubdirs-nogpu

git config core.sparseCheckout true

echo "!arch/*" > .git/info/sparse-checkout
echo "!tools/arch/*" >> .git/info/sparse-checkout
echo "/*/" >> .git/info/sparse-checkout
echo "/*" >> .git/info/sparse-checkout
echo "arch/.gitignore" >> .git/info/sparse-checkout
echo "arch/Kconfig" >> .git/info/sparse-checkout
echo "arch/arm64/" >> .git/info/sparse-checkout
echo "arch/loongarch/" >> .git/info/sparse-checkout
echo "arch/mips/" >> .git/info/sparse-checkout
echo "arch/powerpc/" >> .git/info/sparse-checkout
echo "arch/riscv/" >> .git/info/sparse-checkout
echo "arch/s390/" >> .git/info/sparse-checkout
echo "arch/x86/" >> .git/info/sparse-checkout
echo "drivers/perf/"  >> .git/info/sparse-checkout
echo "tools/arch/x86/" >> .git/info/sparse-checkout
echo "tools/arch/arm64/" >> .git/info/sparse-checkout
echo "tools/arch/s390x/" >> .git/info/sparse-checkout
for i in "${stubdirs[@]}"; do
	if [[ $i == "arch/arm64/crypto" ||
	      $i == "arch/loongarch/crypto" ||
	      $i == "arch/mips/crypto" ||
	      $i == "arch/powerpc/crypto" ||
	      $i == "arch/riscv/crypto" ||
	      $i == "arch/s390/crypto" ||
	      $i == "arch/x86/crypto" ]]; then
		continue
	fi
	echo "!$i" >> .git/info/sparse-checkout
done
echo "!Documentation" >> .git/info/sparse-checkout
echo "Documentation/admin-guide/cgroup-v2.rst" >> .git/info/sparse-checkout
echo "Documentation/admin-guide/kernel-parameters.txt" >> .git/info/sparse-checkout
echo "Documentation/admin-guide/serial-console.rst" >> .git/info/sparse-checkout
echo "Documentation/process/*" >> .git/info/sparse-checkout
echo "Documentation/virtual/*" >> .git/info/sparse-checkout
echo "Documentation/virt/*" >> .git/info/sparse-checkout
echo "Documentation/x86/*" >> .git/info/sparse-checkout

git read-tree -mu HEAD

for i in "${stubdirs[@]}"; do
	if [[ $i == "drivers/lguest" ]]; then
		continue
	fi
	mkdir -p $i
	if [[ $i != arch*crypto ]]; then
		touch $i/Makefile
	fi
	if [[ $i != "drivers/cdrom" &&
		  $i != "drivers/char/mwave" &&
		  $i != "drivers/char/xilinx_hwicap" &&
		  $i != "drivers/dio" &&
		  $i != "drivers/gpu" &&
		  $i != "drivers/message" &&
		  $i != "drivers/nubus" &&
		  $i != "drivers/ps3" &&
		  $i != "drivers/sbus" &&
		  $i != "drivers/tc" &&
		  $i != "drivers/video/fbdev/i810" &&
		  $i != "drivers/video/fbdev/intelfb" ]]; then
		touch $i/Kconfig
	fi
done

# One off case for user-mode Linux
mkdir -p arch/um/scripts
touch arch/um/scripts/Makefile.rules
